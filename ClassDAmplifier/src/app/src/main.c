/**
 * @author		Agustin Alba Chicar
 * @author		Maximiliano Vega
 * @file		main.c
 * @brief		This is the main file which initializes the peripherals and then it leaves the control to the FreeRTOS OS
 * @date		September, 2016
 * @version		1.0
 * @todo
 * @bug
 */

/**
 * @note Includes
 */
#include "appConfig.h"
#include "appInit.h"
#include "appHandlers.h"

#define	ITERATIONS	15
/**
 * @note Public variables
 */

/**
 * @note Variables privadas
 */


/**
 * @note Funciones publicas
 */
const uint32_t triangleWave[MODULATION_SAMPLES] = {0, 2047, 4095, 2047, 0};

const uint32_t x_in[256]= { 2047,  2078,  2110,  2141,  2172,  2203,  2234,  2265,  2296,  2326,  2356,  2386,  2415,  2444,  2473,  2501,  2529,  2556,  2583,  2609,  2635,  2660,  2684,  2708,  2732,  2754,  2776,  2797,  2818,  2837,  2856,  2874,  2891,  2908,  2923,  2938,  2952,  2965,  2977,  2988,  2998,  3007,  3016,  3023,  3029,  3035,  3039,  3043,  3045,  3047,  3047,  3047,  3045,  3043,  3039,  3035,  3029,  3023,  3016,  3007,  2998,  2988,  2977,  2965,  2952,  2938,  2923,  2908,  2891,  2874,  2856,  2837,  2818,  2797,  2776,  2754,  2732,  2708,  2684,  2660,  2635,  2609,  2583,  2556,  2529,  2501,  2473,  2444,  2415,  2386,  2356,  2326,  2296,  2265,  2234,  2203,  2172,  2141,  2110,  2078,  2047,  2016,  1984,  1953,  1922,  1891,  1860,  1829,  1798,  1768,  1738,  1708,  1679,  1650,  1621,  1593,  1565,  1538,  1511,  1485,  1459,  1434,  1410,  1386,  1362,  1340,  1318,  1297,  1276,  1257,  1238,  1220,  1203,  1186,  1171,  1156,  1142,  1129,  1117,  1106,  1096,  1087,  1078,  1071,  1065,  1059,  1055,  1051,  1049,  1047,  1047,  1047,  1049,  1051,  1055,  1059,  1065,  1071,  1078,  1087,  1096,  1106,  1117,  1129,  1142,  1156,  1171,  1186,  1203,  1220,  1238,  1257,  1276,  1297,  1318,  1340,  1362,  1386,  1410,  1434,  1459,  1485,  1511,  1538,  1565,  1593,  1621,  1650,  1679,  1708,  1738,  1768,  1798,  1829,  1860,  1891,  1922,  1953,  1984,  2016,  2047,  2078,  2110,  2141,  2172,  2203,  2234,  2265,  2296,  2326,  2356,  2386,  2415,  2444,  2473,  2501,  2529,  2556,  2583,  2609,  2635,  2660,  2684,  2708,  2732,  2754,  2776,  2797,  2818,  2837,  2856,  2874,  2891,  2908,  2923,  2938,  2952,  2965,  2977,  2988,  2998,  3007,  3016,  3023,  3029,  3035,  3039,  3043,  3045,  3047,  3047,  3047,  3045,  3043,  3039,  3035};

int main( void ){
	uint32_t i;
	uint32_t j;


	appInitOutputs();
	//appInitADC();

	GPIO_SetDir(0, 1 << 22, 1);

	while(1){
		for(i = 0; i < 256; i += 2){
			appADCEndOfConversionHandler(ADC_CHANNEL_ID, x_in[i]);
			LPC_GPIO0->FIOSET = 1 << 22;
			for(j = 0; j < ITERATIONS; j++);
			appADCEndOfConversionHandler(ADC_CHANNEL_ID, x_in[i+1]);
			LPC_GPIO0->FIOCLR = 1 << 22;
			for(j = 0; j < ITERATIONS; j++);
//			for(j = 0; j < ITERATIONS; j++);
//			LPC_GPIO0->FIOSET = 1 << 22;
//			for(j = 0; j < ITERATIONS; j++);
//			LPC_GPIO0->FIOCLR = 1 << 22;

		}
	}

	return 1;
}

